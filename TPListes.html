<!DOCTYPE html>
<html lang="en" xmlns:css="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>Test Liste</title>
</head>
<body>
<style>.highlight {text-decoration-color: #fff168} </style>

<div css:hidden id="login" ></div>
Login : <input id="Login"type="text">
Password: <input id="Password" type="text">
</div>


<div id="result">
</div>
List to create <input type='texte' name='listName'>
<button name='addList'>Create a list</button>


<script src="./jquery-3.3.1.js" type="text/javascript"></script>

<script>
    function displayLists() {
        /* clean the place */
        $("#result").empty();

        /* get the todo lists in data from ajax server call */
        $.ajax( {
            url: "http://92.222.69.104:80/todo/listes",
            headers: {"login": "MICHAUD", "password": "Eric"}
            }).done(function (data) {

            /* add a first empty list */
            $("div#result").append("<ul class='result'></ul>");
            /* add en list for each element of data */
            data.todoListes.forEach(
                function (list) {
                /* console.log(list);*/
                    if (list.name !== null) {
                        var listName = list.name.replace(/ /g, "");
                        $("ul.result:last-child").append(
                            "<li class='list'>" + list.name +
                            "<button class='buttonDelList' listname='" + list.name + "'> delete List </button>" +
                            "</li>");

                        /* add a list of items in any case even if empty */
                        $("li.list:last-child").append("<ul class='" + listName + "'></ul>");
                        if (list.elements.length != 0) {
                            list.elements.forEach(
                                function (item) {
                                    console.log(item);
                                    $("ul." + listName + ":last-child").append("<li class='item'>" + item + "</li>");
                                });
                            /* add a button to add item*/
                        }

                        $("ul." + listName).append("<button class='button'> addto" + listName + "</button>");
                    }
                });

            /* Create an action on each delete List button */
            $("button.buttonDelList").on("click", function () {
                console.log("ok for delete :" + $(this).attr('listname'));
            });

        });

        /* Create an  action on createliste button */
        $("button[name=addList]").on("click",function(){
            var listName=$("input[name=listName]").val();
            console.log(listName);
            createNewList(listName);
        });

    }

/*    JSON.stringify([{"nom" :"TOTO1","prenom":"TATA"},
        {"nom" : "TOTO2", "prenom":"TATA"}]),*/

    function createNewList(nom) {
        if (nom!==null) {
            $.ajax({
                url: "http://92.222.69.104:80/todo/listes",
                headers: {"login": "MICHAUD", "password": "Eric"}
            }).done(
                function (data) {
                    console.log(data);
                    newlist = {name: nom, elements: []};
                    data.todoListes.push(newlist);
                    console.log(data);

                    $.ajax({
                        type: 'post',
                        url: "http://92.222.69.104:80/todo/listes",
                        data: JSON.stringify(data),
                        contentType: "application/json; charset=utf-8"
                    }).done(function (data) {
                        console.log(data)
                    });
                });
            displayLists();
            }
        };


    function deleteList(listName) {
        if (listName!==null) {
            /*Call service 1 to get object list */
            $.ajax({
                url: "http://92.222.69.104:80/todo/listes",
                headers: {"login": "MICHAUD", "password": "Eric"}
            }).done(
                function (data) {
                    var index=0;
                    /* find the name in the list */
                    data.todoListes.forEach( function (list) {
                        console.log(list);
                        if (list.name === listName) {
                            console.log("liste " + listName + " trouvée: index= "+index);
                            data.todoListes.splice(index,1);
                            }
                        index+=1;
                        });

                    console.log(data);

                    $.ajax({
                        type: 'post',
                        url: "http://92.222.69.104:80/todo/listes",
                        data: JSON.stringify(data),
                        contentType: "application/json; charset=utf-8"
                    }).done(function (data) {
                        console.log(data)
                    });
                });
        }
    };



    function createnewItem(nomliste,nomitem) {
        $.ajax({
            url: "http://92.222.69.104:80/todo/listes",
            headers: {"login": "MICHAUD", "password": "Eric"}
            }).done(
                function (data) {
                console.log(data);
                data.todoListes.forEach( function(liste) {
                    if (liste.name === nomliste) {
                        liste.elements.push(nomitem);
                        }
                    });
                console.log(data);

                $.ajax({
                    type: 'post',
                    url: "http://92.222.69.104:80/todo/listes",
                    data: JSON.stringify(data),
                    contentType: "application/json; charset=utf-8"
                    }).done(function (data) {
                        console.log(data)
                        });
                });
        };

    /*
    function displayListe(name,password) {
        $.ajax({
            url: "http://92.222.69.104:80/todo/listes",
            headers: {"login": "MICHAUD", "password": "Eric"}
        }).done(
            function (data) {
                console.log(data);
                data.todoListes.forEach( function(liste) {
                    if (liste.name == nomliste) {
                        liste.elements.push(nomitem);
                    }
                });
                console.log(data);

                $.ajax({
                    type: 'post',
                    url: "http://92.222.69.104:80/todo/listes",
                    data: JSON.stringify(data),
                    contentType: "application/json; charset=utf-8"
                }).done(function (data) {
                    console.log(data)
                });
            });
    };
    */



    $(document).ready(function() {
        /*alert("Le document est chargé");*/
        displayLists("MICHAUD","Eric");
    });




</script>

</body>
</html>